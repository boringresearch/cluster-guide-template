---
title: "Using Stata"
output: html_document
---

# Using Stata

On both Pod and Knot, Stata/MP 15 is available with up to 24 cores. In order to use Stata, you will need to be added to the `econ` group (contact Fuzzy Rogers - fuz(at)ucsb.edu).

## Loading Stata

To load Stata, enter the command

```
/sw/stata/stata-mp
```

To exit, enter `exit`. Specific versions of Stata can be used by entering the `version #` command within Stata.

To load the Stata GUI, connect to a cluster via an XWindows environment and then enter the command

```
/sw/stata/xstata-mp
```

The GUI can be useful for viewing graphics, but will be relatively slow.

*Remember: Most analyses should be performed on compute nodes by submitting jobs. The login node should only be used for simple analyses, testing, or debugging.*

## User-written packages

User-written Stata packages can be installed by using the Stata command `ssc install package` and should be stored inside your home directory. Point to the packages in do-files by using the Stata command `sysdir set PLUS dir` where `dir` should be the path to the `ado/plus` directory inside your home folder.

## Example job files

Note that Stata has a `set processors #` command that should be included in do-files and match the requested resources in job files (up to 24 processors). Similarly, there is a `set max_memory #` command that can also be included.

Also note that these job files run Stata in batch mode (`-b`), which automatically creates a plain-text log file in the current working directory. As a result, log commands do not need to be included in do-files.

To change Stata's temporary files directory, include the command `export STATATMP=dir` where `dir` is the directory of your choice, placed before running Stata.

### Knot

```
#!/bin/bash
#PBS -l nodes=1:ppn=12
#PBS -l walltime=2:00:00
#PBS -V
#PBS -m abe
#PBS -M user@ucsb.edu

cd $PBS_O_WORKDIR/

/sw/stata/stata-mp -b do script.do
```

### Pod

```
#!/bin/bash
#SBATCH --nodes=1 --ntasks-per-node=24
#SBATCH --time=2:00:00
#SBATCH --mail-type=ALL
#SBATCH --mail-user=user@ucsb.edu

cd $SLURM_SUBMIT_DIR

/sw/stata/stata-mp -b do script.do
```
